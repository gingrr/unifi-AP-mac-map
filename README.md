# unifi-real-wifi-macs

A small Bash utility for auditing UniFi Access Points over SSH and extracting their **real 5 GHz BSSIDs** (MAC addresses) for a specific SSID, **directly from the AP firmware**, without trusting the UniFi controller.

It is designed for field engineers and network admins who need accurate per-AP MAC data for systems like Vocera, voice WLANs, or inventory reconciliation.

---

## What this script does

For each AP IP in your list, the script:

1. Connects to the AP over SSH (using `sshpass` + password auth).
2. Runs:
   - `hostname`
   - `iwconfig`
3. Parses the `iwconfig` output locally to:
   - Track the current `ESSID:"..."`
   - Find lines with `Frequency: 5.xxx GHz` and `Access Point: XX:XX:XX:XX:XX:XX`
   - Match only entries whose ESSID equals the SSID you care about (e.g. `StrykerWifi`)
   - Extract the **5 GHz BSSID** and normalize it to uppercase colon-separated MAC.
4. Writes a CSV file summarizing the results:

```text
wifi_macs.csv

ip,host_or_friendly,mac_5ghz_or_status
10.0.0.186,MainOfficeAP,FE:9F:C2:FF:10:32
10.0.1.200,1stGradeAP,02:9F:C2:FF:10:32
10.0.3.181,HallwayAP,NOT_FOUND
...
```

If something goes wrong per AP, you get a clear status in place of the MAC:

- `TIMEOUT_22`  → port 22 did not respond before timeout
- `CLOSED_22`   → TCP port 22 is closed
- `AUTH_FAILED` → SSH auth failed with the provided username/password
- `NO_OUTPUT`   → SSH succeeded but returned nothing
- `NOT_FOUND`   → no 5 GHz BSSID found for that SSID on that AP

---

## Requirements

### On the machine running the script (Mac / Linux)

- `bash`
- `ssh`
- `sshpass`
- `nc` (netcat)
- `awk`, `sed`, `grep`, `wc`, `tr`

### On the UniFi APs

- SSH enabled
- Same SSH username/password on all APs
- `iwconfig` available (standard on UniFi firmware)
- The SSID you care about (e.g. `StrykerWifi`) is being broadcast on 5 GHz

---

## Files

- `get-real-macs.sh` – the main script
- `ips.csv` – list of APs (IP + optional friendly name)
- `wifi_macs.csv` – output file generated by the script

---

## Setting up `ips.csv`

Create a file named **`ips.csv`** in the same directory as the script.

Supported formats:

### With header (recommended)

```text
ip,friendlyName
10.0.0.186,MainOfficeAP
10.0.1.200,1stGradeAP
10.0.3.181,HallwayAP
```

### Without header

```text
10.0.0.186,MainOfficeAP
10.0.1.200,1stGradeAP
10.0.3.181,HallwayAP
```

- Column 1 = IP address of the AP
- Column 2 = Friendly name (used in output). If omitted, the script will fall back to the AP’s hostname (from `hostname`) or the IP.

The script automatically skips a header row that starts with `ip` or `ip,`.

---

## Script configuration

Open `get-real-macs.sh` and set these variables near the top:

```bash
SSH_USER="C5xWnwtwo"         # your UniFi SSH username
SSH_PASS="your_password_here"  # your UniFi SSH password
SSID_FILTER="StrykerWifi"      # SSID whose 5GHz MAC you want
```

You can change `SSID_FILTER` to any SSID that is being broadcast on 5 GHz, for example:

```bash
SSID_FILTER="WY_SCHOOL"
# or
SSID_FILTER="WY_PUBLIC"
# or
SSID_FILTER="Vocera"
```

Connection parameters (optional to tweak):

```bash
SSH_PORT="22"
CONNECT_TIMEOUT="6"
NC_TIMEOUT="3"
```

---

## Installation

### macOS (Homebrew)

1. Install `sshpass` and `netcat` if you don’t already have them:

```bash
brew install hudochenkov/sshpass/sshpass
# nc (netcat) ships with macOS; if you prefer, you can also:
# brew install netcat
```

2. Put the script and `ips.csv` in a directory, e.g.:

```bash
~/Desktop/unifi-wifi-macs/
```

3. Make the script executable:

```bash
cd ~/Desktop/unifi-wifi-macs
chmod +x get-real-macs.sh
```

4. Edit the script and set:

```bash
SSH_USER="..."
SSH_PASS="..."
SSID_FILTER="StrykerWifi"
```

---

### Debian / Ubuntu / Raspberry Pi OS

1. Install dependencies:

```bash
sudo apt update
sudo apt install -y sshpass netcat-openbsd
```

2. Copy `get-real-macs.sh` and `ips.csv` to a directory, e.g.:

```bash
mkdir -p ~/unifi-wifi-macs
cp get-real-macs.sh ips.csv ~/unifi-wifi-macs/
cd ~/unifi-wifi-macs
chmod +x get-real-macs.sh
```

3. Configure credentials and SSID in the script:

```bash
SSH_USER="..."
SSH_PASS="..."
SSID_FILTER="StrykerWifi"
```

---

### Windows (via WSL)

On Windows, the easiest way is to use **WSL (Windows Subsystem for Linux)**:

1. Enable WSL and install Ubuntu from the Microsoft Store.
2. Inside Ubuntu, follow the **Debian / Ubuntu** instructions above.
3. Place `get-real-macs.sh` and `ips.csv` inside your WSL home folder and run from there.

---

## Running the script

From the directory containing `get-real-macs.sh` and `ips.csv`:

```bash
bash ./get-real-macs.sh
```

If everything is configured correctly, you’ll see something like:

```text
Wrote 52 lines to /path/to/wifi_macs.csv
```

Then open `wifi_macs.csv` with:

```bash
cat wifi_macs.csv
# or
open wifi_macs.csv      # on macOS
# or
xdg-open wifi_macs.csv  # on most Linux desktops
```

Example output:

```text
ip,host_or_friendly,mac_5ghz_or_status
10.0.0.186,MainOfficeAP,FE:9F:C2:FF:10:32
10.0.1.200,1stGradeAP,02:9F:C2:FF:10:32
10.0.3.181,HallwayAP,NOT_FOUND
```

---

## Notes and caveats

- The script **does not trust the UniFi controller**; it only uses on-box commands (`hostname`, `iwconfig`).
- If an AP is not broadcasting the SSID on 5 GHz, you will see `NOT_FOUND` for that IP.
- Some APs may have multiple 5 GHz BSSIDs (multiple SSIDs or VAPs). This script returns **only the 5 GHz BSSID associated with `SSID_FILTER`**.
- If you want all 5 GHz BSSIDs per AP in one line (e.g. inventory), the parsing logic can be easily extended.

---

## License

This project is licensed under the **MIT License**. You are free to use, modify, and distribute it, including commercially, with minimal restrictions. See `LICENSE` if you add one to the repo.

